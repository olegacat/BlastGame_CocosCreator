window.__require=function t(e,o,i){function r(s,c){if(!o[s]){if(!e[s]){var l=s.split("/");if(l=l[l.length-1],!e[l]){var a="function"==typeof __require&&__require;if(!c&&a)return a(l,!0);if(n)return n(l,!0);throw new Error("Cannot find module '"+s+"'")}s=l}var u=o[s]={exports:{}};e[s][0].call(u.exports,function(t){return r(e[s][1][t]||t)},u,u.exports,t,e,o,i)}return o[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<i.length;s++)r(i[s]);return r}({GameManager:[function(t,e,o){"use strict";cc._RF.push(e,"e59c8znSWdAdpZ0M/5hz0Le","GameManager");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(r,n){function s(t){try{l(i.next(t))}catch(e){n(e)}}function c(t){try{l(i.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}l((i=i.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var o,i,r,n,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function c(t){return function(e){return l([t,e])}}function l(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){s.label=n[1];break}if(6===n[0]&&s.label<r[1]){s.label=r[1],r=n;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(n);break}r[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(c){n=[6,c],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var l=t("../model/GameModel"),a=t("../view/HUDView"),u=t("./TileBoardView"),p=cc._decorator,h=p.ccclass,d=p.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.board=null,e.hud=null,e.movesLimit=30,e.targetScore=500,e.startScreen=null,e.resultModal=null,e.resultTitle=null,e.resultScore=null,e.model=null,e}return r(e,t),e.prototype.onLoad=function(){this.model=new l.GameModel(this.movesLimit,this.targetScore),this.board.node.on("MATCH_FOUND",this.handleMatch,this),this.board.setInteraction(!1)},e.prototype.start=function(){this.updateUI(),this.startScreen&&(this.startScreen.active=!0),this.resultModal&&(this.resultModal.active=!1)},e.prototype.onPlayButtonClicked=function(){this.startScreen&&(this.startScreen.active=!1),this.board.setInteraction(!0),this.model=new l.GameModel(this.movesLimit,this.targetScore),this.updateUI(),console.log("Game started!")},e.prototype.handleMatch=function(t){return s(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return console.log("match count arrived",t),this.model.moves<=0?[2]:(this.model.funcUseMoves(),this.model.addScore(t),this.updateUI(),[4,this.waitForBoard()]);case 1:return e.sent(),this.checkGameStatus(),[2]}})})},e.prototype.checkGameStatus=function(){this.model.isWin?this.finishGame("You win!"):this.model.moves<=0?this.finishGame("You lost (There is no moves)"):this.board.gridLogic.hasPossibleMatches()||this.finishGame("You Lost (No tiles left)")},e.prototype.updateUI=function(){this.hud&&this.hud.updateHUD(this.model)},e.prototype.finishGame=function(t){this.board.setInteraction(!1),this.resultModal&&(this.resultModal.active=!0,this.resultTitle&&(this.resultTitle.string=t),this.resultScore&&(this.resultScore.string="Final Score: "+this.model.score),this.resultModal.scale=.5,cc.tween(this.resultModal).to(.3,{scale:1},{easing:"backOut"}).start()),console.log("GAME OVER: "+t)},e.prototype.waitForBoard=function(){return s(this,void 0,Promise,function(){var t=this;return c(this,function(){return[2,new Promise(function(e){var o=function(){t.board.getIsProcessing()?setTimeout(o,100):e()};o()})]})})},e.prototype.restartGame=function(){cc.director.loadScene(cc.director.getScene().name)},n([d(u.default)],e.prototype,"board",void 0),n([d(a.default)],e.prototype,"hud",void 0),n([d({type:cc.Integer,displayName:"Limit for moves"})],e.prototype,"movesLimit",void 0),n([d({type:cc.Integer,displayName:"Score to win"})],e.prototype,"targetScore",void 0),n([d(cc.Node)],e.prototype,"startScreen",void 0),n([d(cc.Node)],e.prototype,"resultModal",void 0),n([d(cc.Label)],e.prototype,"resultTitle",void 0),n([d(cc.Label)],e.prototype,"resultScore",void 0),n([h],e)}(cc.Component);o.default=f,cc._RF.pop()},{"../model/GameModel":"GameModel","../view/HUDView":"HUDView","./TileBoardView":"TileBoardView"}],GameModel:[function(t,e,o){"use strict";cc._RF.push(e,"74e738KS5ZKxZJwj8nzzVJP","GameModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameModel=void 0;var i=function(){function t(t,e){this.score=0,this.moves=t,this.targetScore=e}return t.prototype.addScore=function(t){var e=t>5?15*(t-5):0;this.score+=e+10},t.prototype.funcUseMoves=function(){return this.moves>0&&(this.moves--,!0)},Object.defineProperty(t.prototype,"isWin",{get:function(){return this.score>=this.targetScore},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isGameOver",{get:function(){return this.moves<=0&&this.score<this.targetScore},enumerable:!1,configurable:!0}),t}();o.GameModel=i,cc._RF.pop()},{}],Grid:[function(t,e,o){"use strict";var i;cc._RF.push(e,"ef27fTkw/FD7IzqpH7KzpNE","Grid"),Object.defineProperty(o,"__esModule",{value:!0}),o.Grid=void 0;var r=((i={})[-1]="_____",i[0]="BLUE",i[1]="GREEN",i[2]="PURPLE",i[3]="RED",i[4]="YELLOW",i),n=function(){function t(t,e,o,i,r,n){var s=this;this.emptyCellIdx=-1,this.tileSize=null,this.tileGapHorizontal=1,this.tileGapVertical=4,this.amountRows=t,this.amountCols=e,this.colorsCount=o,this.tileSize=i,this.tileGapHorizontal=r,this.tileGapVertical=n,this.data=Array.from({length:t},function(){return Array.from({length:e},function(){return s.randomColor()})})}return t.prototype.debugPrint=function(){console.table(this.data.map(function(t){return t.map(function(t){var e;return null!==(e=r[t])&&void 0!==e?e:t})}))},t.prototype.applyGravity=function(){for(var t=[],e=[],o=0;o<this.amountCols;o++){for(var i=this.amountRows-1,r=this.amountRows-1;r>=0;r--)(n=this.data[r][o])!==this.emptyCellIdx&&(r!==i&&(this.data[i][o]=n,this.data[r][o]=this.emptyCellIdx,t.push({fromRow:r,toRow:i,col:o,colorIdx:n})),i--);for(r=i;r>=0;r--){var n=this.randomColor();this.data[r][o]=n,e.push({row:r,col:o,color:n})}}return{moves:t,newCells:e}},t.prototype.getMatches=function(t,e){var o=this,i=this.data[t][e];if(i===this.emptyCellIdx)return{matches:[],colorIdx:i};var r=[],n=new Set,s=function(t,e){var c=t+","+e;if(!n.has(c)&&!(t<0||t>=o.amountRows||e<0||e>=o.amountCols)){var l=o.data[t][e];l!==o.emptyCellIdx&&l===i&&(n.add(c),r.push({row:t,col:e,colorIdx:l}),s(t+1,e),s(t-1,e),s(t,e+1),s(t,e-1))}};return s(t,e),{matches:r,colorIdx:i}},t.prototype.destroyMatches=function(t){var e=this;t.forEach(function(t){e.data[t.row][t.col]=e.emptyCellIdx})},t.prototype.hasPossibleMatches=function(){for(var t=0;t<this.amountRows;t++)for(var e=0;e<this.amountCols;e++){var o=this.data[t][e];if(o!==this.emptyCellIdx){if(e+1<this.amountCols&&this.data[t][e+1]===o)return!0;if(t+1<this.amountRows&&this.data[t+1][e]===o)return!0}}return!1},t.prototype.calculatePosition=function(t,e){var o=this.tileSize.width,i=this.tileSize.height,r=this.amountCols*o+(this.amountRows-1)*this.tileGapHorizontal,n=(this.amountRows*i+(this.amountCols-1)*this.tileGapVertical)/2-i/2;return{newX:-r/2+o/2+e*(o+this.tileGapHorizontal),newY:n-t*(i+this.tileGapVertical)}},t.prototype.randomColor=function(){return Math.floor(Math.random()*this.colorsCount)},t.prototype.getColorIdx=function(t,e){return this.data[t][e]},t.prototype.setColorIdx=function(t,e,o){this.data[t][e]=o},t}();o.Grid=n,cc._RF.pop()},{}],HUDView:[function(t,e,o){"use strict";cc._RF.push(e,"00204Wc8chOtqO//4gYpbac","HUDView");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,l=s.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.movesLabel=null,e.scoreLabel=null,e}return r(e,t),e.prototype.updateHUD=function(t){this.movesLabel&&(this.movesLabel.string=t.moves.toString()),this.scoreLabel&&(this.scoreLabel.string=t.score+"/"+t.targetScore)},n([l(cc.Label)],e.prototype,"movesLabel",void 0),n([l(cc.Label)],e.prototype,"scoreLabel",void 0),n([c],e)}(cc.Component);o.default=a,cc._RF.pop()},{}],TileBoardView:[function(t,e,o){"use strict";cc._RF.push(e,"69d7bCrX7tA3LaCdbwaROHV","TileBoardView");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(r,n){function s(t){try{l(i.next(t))}catch(e){n(e)}}function c(t){try{l(i.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}l((i=i.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var o,i,r,n,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function c(t){return function(e){return l([t,e])}}function l(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){s.label=n[1];break}if(6===n[0]&&s.label<r[1]){s.label=r[1],r=n;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(n);break}r[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(c){n=[6,c],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var l=t("../model/Grid"),a=t("../view/TileView"),u=cc._decorator,p=u.ccclass,h=u.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isProcessing=!1,e.boardContainer=null,e.tilePrefab=null,e.rows=9,e.columns=9,e.tileGapHorizontal=1,e.tileGapVertical=4,e.destroySound=null,e.soundDullClick=null,e.tileSize=null,e.tiles=[],e.gridLogic=null,e.amountOfColorsInTile=5,e}return r(e,t),e.prototype.start=function(){this.updateTileSize(),this.gridLogic=new l.Grid(this.rows,this.columns,this.amountOfColorsInTile,this.tileSize,this.tileGapHorizontal,this.tileGapVertical),this.generateGrid()},e.prototype.updateTileSize=function(){var t=this.boardContainer.getContentSize(),e=t.width-108,o=t.height-108,i=(e-(this.columns-1)*this.tileGapHorizontal)/this.columns,r=(o-(this.rows-1)*this.tileGapVertical)/this.rows;this.tileSize=cc.size(i,r)},e.prototype.generateGrid=function(){for(var t=0;t<this.rows;t++){this.tiles[t]=[];for(var e=0;e<this.columns;e++)this.createTile(t,e)}},e.prototype.createTile=function(t,e){var o=this,i=cc.instantiate(this.tilePrefab);i.parent=this.boardContainer;var r=i.getComponent(a.TileView),n=this.gridLogic.getColorIdx(t,e);r.init(t,e,n,this.tileSize),this.tiles[t][e]=r;var s=this.gridLogic.calculatePosition(t,e),c=s.newX,l=s.newY;i.zIndex=this.rows-t,i.setPosition(c,l),i.on(cc.Node.EventType.TOUCH_END,function(t){var e=t.target.getComponent(a.TileView);o.onTileClick(e.row,e.column)})},e.prototype.onTileClick=function(t,e){if(this.isProcessing){if(this.soundDullClick){var o=cc.audioEngine.playEffect(this.soundDullClick,!1);cc.audioEngine.setVolume(o,.2)}}else{var i=this.gridLogic.getMatches(t,e),r=i.matches;if(i.colorIdx,1!==r.length)this.destroySound&&(o=cc.audioEngine.playEffect(this.destroySound,!1),cc.audioEngine.setVolume(o,.2)),this.isProcessing=!0,this.handleDestroyingTiles(r),this.node.emit("MATCH_FOUND",r.length);else if(this.tiles[t][e].playShakeAnimation(),this.soundDullClick){o=cc.audioEngine.playEffect(this.soundDullClick,!1);cc.audioEngine.setVolume(o,.2)}}},e.prototype.handleDestroyingTiles=function(t){return s(this,void 0,void 0,function(){var e,o,i,r=this;return c(this,function(n){switch(n.label){case 0:return t.forEach(function(t){var e=r.tiles[t.row][t.col];e?e.playDestroyAnimation():console.error("tile wasnt found","[",t.row,"]","[",t.col,"]")}),t.forEach(function(t){r.tiles[t.row][t.col]&&(r.tiles[t.row][t.col]=null)}),this.gridLogic.destroyMatches(t),e=this.gridLogic.applyGravity(),o=e.moves,i=e.newCells,console.log("newCells from grid File: ",i),[4,Promise.all([this.animateFallingTiles(o),this.handleSpawningNewTiles(i)])];case 1:return n.sent(),this.isProcessing=!1,[2]}})})},e.prototype.animateFallingTiles=function(t){var e=this,o=t.map(function(t){var o=e.tiles[t.fromRow][t.col];if(!o)return console.log("tile wasnt found"),Promise.resolve();o.row=t.toRow,o.column=t.col;var i=e.gridLogic.calculatePosition(t.toRow,t.col).newY;return new Promise(function(r){cc.tween(o.node).to(.5,{y:i},{easing:"bounceOut"}).call(function(){e.tiles[t.toRow][t.col]=o,e.tiles[t.toRow][t.col].node.zIndex=e.rows-t.toRow,e.tiles[t.fromRow][t.col]===o&&(e.tiles[t.fromRow][t.col]=null),r()}).start()})});return Promise.all(o)},e.prototype.handleSpawningNewTiles=function(t){return s(this,void 0,Promise,function(){var e,o=this;return c(this,function(i){switch(i.label){case 0:return e=[],t.forEach(function(t){o.createTile(t.row,t.col);var i=o.tiles[t.row][t.col];if(i){var r=o.gridLogic.calculatePosition(i.row,i.column),n=r.newX,s=r.newY,c=s+o.tileSize.height;i.node.setPosition(n,s+c*o.rows-t.row),e.push(new Promise(function(t){cc.tween(i.node).to(.6,{y:s},{easing:"cubicOut"}).call(t).start()}))}else console.log("tileView wasnt found")}),[4,Promise.all(e)];case 1:return i.sent(),[2]}})})},e.prototype.getIsProcessing=function(){return this.isProcessing},e.prototype.setInteraction=function(t){this.isProcessing=!t},n([h(cc.Node)],e.prototype,"boardContainer",void 0),n([h(cc.Prefab)],e.prototype,"tilePrefab",void 0),n([h],e.prototype,"rows",void 0),n([h],e.prototype,"columns",void 0),n([h],e.prototype,"tileGapHorizontal",void 0),n([h],e.prototype,"tileGapVertical",void 0),n([h({type:cc.AudioClip})],e.prototype,"destroySound",void 0),n([h({type:cc.AudioClip})],e.prototype,"soundDullClick",void 0),n([p],e)}(cc.Component);o.default=d,cc._RF.pop()},{"../model/Grid":"Grid","../view/TileView":"TileView"}],TileView:[function(t,e,o){"use strict";cc._RF.push(e,"fbac6gSeLVPoriWH2U5usBA","TileView");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.TileView=void 0;var s=cc._decorator,c=s.ccclass,l=s.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=null,e.colorSprites=[],e.destroyParticles=null,e.currentColorIndex=0,e.row=0,e.column=0,e}return r(e,t),e.prototype.init=function(t,e,o,i){this.row=t,this.column=e,this.currentColorIndex=o,this.sprite.spriteFrame=this.colorSprites[o],i&&this.node.setContentSize(i)},e.prototype.playShakeAnimation=function(){this.node.stopAllActions(),this.node.angle=0,this.node.scale=0,cc.tween(this.node).to(.1,{angle:7,scale:.9}).to(.1,{angle:-7}).to(.1,{angle:8,scale:.95}).to(.1,{angle:4,scale:.9}).to(.1,{angle:0,scale:1}).start()},e.prototype.playDestroyAnimation=function(){var t=this;return new Promise(function(e){if(!t.destroyParticles)return console.warn("destroyParticles is not connected!"),void e();t.sprite.node.active=!1,t.node.zIndex=20,t.destroyParticles.spriteFrame=t.sprite.spriteFrame,t.destroyParticles.resetSystem(),t.scheduleOnce(function(){t.node.destroy(),e()},t.destroyParticles.duration)})},n([l(cc.Sprite)],e.prototype,"sprite",void 0),n([l([cc.SpriteFrame])],e.prototype,"colorSprites",void 0),n([l(cc.ParticleSystem)],e.prototype,"destroyParticles",void 0),n([c],e)}(cc.Component);o.TileView=a,cc._RF.pop()},{}]},{},["GameManager","TileBoardView","GameModel","Grid","HUDView","TileView"]);